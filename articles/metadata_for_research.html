<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Metadata for Research • pxmake</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Metadata for Research">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pxmake</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/first-px-file.html">First px file</a></li>
    <li><a class="dropdown-item" href="../articles/languages.html">Languages</a></li>
    <li><a class="dropdown-item" href="../articles/metadata_for_research.html">Metadata for Research</a></li>
    <li><a class="dropdown-item" href="../articles/micro-files.html">Micro files</a></li>
    <li><a class="dropdown-item" href="../articles/statistics_greenland.html">Statistics Greenland</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Metadata for Research</h1>
            
      

      <div class="d-none name"><code>metadata_for_research.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="metadata-for-researchers">Metadata for Research(ers)<a class="anchor" aria-label="anchor" href="#metadata-for-researchers"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cran</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/anhoej/cprr" class="external-link">cprr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># github</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="co"># devtools::install_github("StatisticsGreenland/pxmake")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://statisticsgreenland.github.io/pxmake/">pxmake</a></span><span class="op">)</span></span>
<span><span class="co"># devtools::install_github("StatisticsGreenland/statgl")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">statgl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># local path</span></span>
<span><span class="va">pgmPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"S:"</span>,<span class="st">"STATFACT"</span>,<span class="st">"GSpakker"</span>,<span class="st">"pxmake"</span>,<span class="st">"vignette"</span>,<span class="st">"mikro"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameter</span></span>
<span><span class="va">reference_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># helpers</span></span>
<span><span class="co">#################</span></span>
<span><span class="co"># By chatGPT:</span></span>
<span><span class="co"># can you convert code on this page to r? </span></span>
<span><span class="co"># "https://blog.ploeh.dk/2018/12/10/danish-cpr-numbers-in-f/"</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># With a few extra iterations chatGPT offered</span></span>
<span><span class="co">#</span></span>
<span></span>
<span><span class="co"># Define the CprNumber class</span></span>
<span><span class="va">CprNumber</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">day</span>, <span class="va">month</span>, <span class="va">year</span>, <span class="va">sequenceNumber</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="va">day</span>, month <span class="op">=</span> <span class="va">month</span>, year <span class="op">=</span> <span class="va">year</span>, sequenceNumber <span class="op">=</span> <span class="va">sequenceNumber</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Convert CprNumber to string</span></span>
<span><span class="va">cprToString</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cpr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d%02d%02d-%04d"</span>, <span class="va">cpr</span><span class="op">$</span><span class="va">day</span>, <span class="va">cpr</span><span class="op">$</span><span class="va">month</span>, <span class="va">cpr</span><span class="op">$</span><span class="va">year</span>, <span class="va">cpr</span><span class="op">$</span><span class="va">sequenceNumber</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate the four-digit year</span></span>
<span><span class="va">calculateFourDigitYear</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">year</span>, <span class="va">sequenceNumber</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">centuryDigit</span> <span class="op">&lt;-</span> <span class="va">sequenceNumber</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">1000</span></span>
<span>  <span class="va">century</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">centuryDigit</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    <span class="st">"1900"</span>, <span class="st">"1900"</span>, <span class="st">"1900"</span>, <span class="st">"1900"</span>, <span class="co"># For centuryDigit 0 to 3</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">36</span><span class="op">)</span> <span class="st">"2000"</span> <span class="kw">else</span> <span class="st">"1900"</span>, <span class="co"># For centuryDigit 4</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">57</span><span class="op">)</span> <span class="st">"2000"</span> <span class="kw">else</span> <span class="st">"1800"</span>, <span class="co"># For centuryDigit 5 to 8</span></span>
<span>    <span class="st">"2000"</span>, <span class="st">"2000"</span>, <span class="st">"2000"</span>, <span class="st">"2000"</span>, <span class="co"># For centuryDigit 9 (and above if needed)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">36</span><span class="op">)</span> <span class="st">"2000"</span> <span class="kw">else</span> <span class="st">"1900"</span> <span class="co"># Default case</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">century</span><span class="op">)</span> <span class="op">+</span> <span class="va">year</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Try to create a CprNumber</span></span>
<span><span class="va">tryCreate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">day</span>, <span class="va">month</span>, <span class="va">year</span>, <span class="va">sequenceNumber</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">month</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;&amp;</span> <span class="va">month</span> <span class="op">&lt;=</span> <span class="fl">12</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">99</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="va">sequenceNumber</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">sequenceNumber</span> <span class="op">&lt;=</span> <span class="fl">9999</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fourDigitYear</span> <span class="op">&lt;-</span> <span class="fu">calculateFourDigitYear</span><span class="op">(</span><span class="va">year</span>, <span class="va">sequenceNumber</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">day</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;&amp;</span> <span class="va">day</span> <span class="op">&lt;=</span> <span class="fu">days_in_month</span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%04d-%02d-01"</span>, <span class="va">fourDigitYear</span>, <span class="va">month</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">CprNumber</span><span class="op">(</span><span class="va">day</span>, <span class="va">month</span>, <span class="va">year</span>, <span class="va">sequenceNumber</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate CPR number</span></span>
<span><span class="va">generateCPR</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">birthdate</span>, <span class="va">sequence</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">day</span> <span class="op">&lt;-</span> <span class="fu">day</span><span class="op">(</span><span class="va">birthdate</span><span class="op">)</span></span>
<span>  <span class="va">month</span> <span class="op">&lt;-</span> <span class="fu">month</span><span class="op">(</span><span class="va">birthdate</span><span class="op">)</span></span>
<span>  <span class="va">year</span> <span class="op">&lt;-</span> <span class="fu">year</span><span class="op">(</span><span class="va">birthdate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span></span>
<span>  <span class="va">sexDigit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">sequenceNumber</span> <span class="op">&lt;-</span> <span class="va">sequence</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="va">sexDigit</span></span>
<span>  </span>
<span>  <span class="va">cpr</span> <span class="op">&lt;-</span> <span class="fu">tryCreate</span><span class="op">(</span><span class="va">day</span>, <span class="va">month</span>, <span class="va">year</span>, <span class="va">sequenceNumber</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cpr</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">cprToString</span><span class="op">(</span><span class="va">cpr</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Invalid CPR parameters"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># # Example usage</span></span>
<span><span class="co"># birthdate &lt;- as.Date("2003-01-02")</span></span>
<span><span class="co"># sequence &lt;- 123</span></span>
<span><span class="co"># sex &lt;- 1</span></span>
<span><span class="co"># generateCPR(birthdate, sequence, sex)</span></span>
<span></span>
<span><span class="co">#################</span></span>
<span></span>
<span><span class="co"># helper function</span></span>
<span><span class="va">copy2clipboard</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">row.names</span><span class="op">=</span><span class="cn">FALSE</span>,<span class="va">col.names</span><span class="op">=</span><span class="cn">FALSE</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"clipboard"</span>,dec <span class="op">=</span> <span class="st">","</span>, sep<span class="op">=</span><span class="st">"\t"</span>, row.names<span class="op">=</span><span class="va">row.names</span>, col.names<span class="op">=</span><span class="va">col.names</span>,<span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># %&gt;% filter(grp=="4" &amp; sex=="F" &amp; age=="33" &amp; area=="956")</span></span>
<span><span class="co"># %&gt;% copy2clipboard</span></span>
<span><span class="co"># %&gt;% view()</span></span>
<span></span>
<span><span class="co">#########################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># first time creation of a px-file takes a lot of time to get translated metadata</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># BUT a lot is already translated to Greenlandic and English</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># these helpers gets some metadata from any Statbank table</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#########################################</span></span>
<span></span>
<span></span>
<span><span class="va">get_codelist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table_id</span>, <span class="va">langs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"kl"</span>, <span class="st">"da"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">enframe</a></span><span class="op">(</span><span class="va">langs</span>, name <span class="op">=</span> <span class="cn">NULL</span>, value <span class="op">=</span> <span class="st">"langs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>try <span class="op">=</span> <span class="fu">map2_chr</span><span class="op">(</span><span class="va">table_id</span>, <span class="va">langs</span>, <span class="va">statgl_url</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>             <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">statgl_meta</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>             <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">pluck</span>,<span class="st">"variables"</span><span class="op">)</span></span>
<span>           <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">unnest</span><span class="op">(</span><span class="va">try</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">unnest</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">values</span>, <span class="va">valueTexts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">select</span><span class="op">(</span>variable <span class="op">=</span> <span class="va">code</span>,</span>
<span>           `variable-code` <span class="op">=</span> <span class="va">text</span>,</span>
<span>           code <span class="op">=</span> <span class="va">values</span>,</span>
<span>           language <span class="op">=</span> <span class="va">langs</span>,</span>
<span>           value <span class="op">=</span> <span class="va">valueTexts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">variable</span>,<span class="va">language</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>order <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># try to get code labels for a variable</span></span>
<span><span class="va">codelist_age</span> <span class="op">&lt;-</span> <span class="fu">get_codelist</span><span class="op">(</span><span class="st">"BEXSTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"age"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="va">variable</span>,<span class="va">code</span>,<span class="va">language</span>,<span class="va">value</span>,<span class="va">order</span><span class="op">)</span></span>
<span></span>
<span><span class="va">get_variable_labels</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table_id</span>, <span class="va">langs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"kl"</span>, <span class="st">"da"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">enframe</a></span><span class="op">(</span><span class="va">langs</span>, name <span class="op">=</span> <span class="cn">NULL</span>, value <span class="op">=</span> <span class="st">"langs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>try <span class="op">=</span> <span class="fu">map2_chr</span><span class="op">(</span><span class="va">table_id</span>, <span class="va">langs</span>, <span class="va">statgl_url</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>             <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">statgl_meta</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>             <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">pluck</span>,<span class="st">"variables"</span><span class="op">)</span></span>
<span>           <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">unnest</span><span class="op">(</span><span class="va">try</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">unnest</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">values</span>, <span class="va">valueTexts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">select</span><span class="op">(</span>`variable-label` <span class="op">=</span> <span class="va">text</span>,</span>
<span>           `variable-code` <span class="op">=</span> <span class="va">code</span>,</span>
<span>           language <span class="op">=</span> <span class="va">langs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># try to get the variable labels for the table</span></span>
<span><span class="va">var_label_time</span> <span class="op">&lt;-</span> <span class="fu">get_variable_labels</span><span class="op">(</span><span class="st">"BEXSTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`variable-code`</span><span class="op">==</span><span class="st">"time"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>At birth or upon immigration, everyone moving to Greenland is
registered in the Danish CPR system, which was adopted in Greenland by
law in 1972. Each individual is assigned a personal identification
number (PIN), a 10-digit code that includes the person’s date of birth,
a sequence number, and their sex.</p>
<p>To ensure efficient and cost-effective administration, the PIN is an
identifier, used as reference key for administrative purposes all across
public sector. Statistics on our society benefit from this, as data from
administrative registers, serves as the primary source for all official
statistics on persons.</p>
<p>With the PIN and access to the registers, one can combine information
nationwide, at microlevel - for each individual. Statistics Greenland is
granted access to all public registers by the Statistical Act, which
also limits dissemination of personal information, except for regulated
research purposes.</p>
<p>The population register is pivotal, as it keeps track on where
citizens live (addresses), legal family ties and other information,
critical for electoral and taxation purposes.</p>
<p>Any contact with public administration requires a PIN, and it is not
possible to live in Greenland without.</p>
<p>To explain how pxmake supports internal production of statistics a
synthetic population is created with look-a-like PINs, some of them
valid, but that is a coincidence.</p>
</div>
<div class="section level2">
<h2 id="a-population-table-from-statbank-greenland-as-a-tidy-dataset">A population table from Statbank Greenland <br>as a tidy
dataset<a class="anchor" aria-label="anchor" href="#a-population-table-from-statbank-greenland-as-a-tidy-dataset"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># get latest January 1st. Population count from</span></span>
<span><span class="co"># Statbank Greenland as a tidy dataset &amp;</span></span>
<span><span class="co"># add fictive birthdates, sequences to generate PIN</span></span>
<span></span>
<span></span>
<span><span class="va">syntpop</span> <span class="op">&lt;-</span> <span class="fu">statgl_fetch</span><span class="op">(</span><span class="st">"BEXSTA"</span>, time<span class="op">=</span><span class="fu">px_top</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>                        .col_code<span class="op">=</span><span class="cn">T</span>, .val_code<span class="op">=</span><span class="cn">T</span>, .eliminate_rest <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">clean_names</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">place_of_birth</span><span class="op">!=</span><span class="st">"T"</span> <span class="op">&amp;</span> </span>
<span>           <span class="va">gender</span><span class="op">!=</span><span class="st">"T"</span> <span class="op">&amp;</span> </span>
<span>           <span class="va">residence_type</span><span class="op">!=</span><span class="st">"T"</span> <span class="op">&amp;</span> </span>
<span>           <span class="va">value</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">uncount</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tally <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, length.out <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>yob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">-</span><span class="va">age</span><span class="op">-</span><span class="fl">1</span>,</span>
<span>  dob <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">yob</span>, <span class="st">"-01-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">days</span><span class="op">(</span><span class="va">tally</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">dob</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>pr_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, length.out <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>,<span class="va">place_of_birth</span>,<span class="va">residence_type</span>, <span class="va">gender</span>,<span class="va">dob</span>,<span class="va">pr_day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lbnr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">dob</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1900</span> <span class="op">&amp;</span> <span class="fu">year</span><span class="op">(</span><span class="va">dob</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1999</span>,</span>
<span>                       <span class="fl">300</span> <span class="op">+</span> <span class="va">pr_day</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">dob</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1900</span>,</span>
<span>                              <span class="fl">500</span> <span class="op">+</span> <span class="va">pr_day</span>,</span>
<span>                              <span class="fl">900</span> <span class="op">+</span> <span class="va">pr_day</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">pr_day</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-micro-data-with-look-a-like-synthetic-pin">Create micro data with look-a-like, synthetic PIN<a class="anchor" aria-label="anchor" href="#create-micro-data-with-look-a-like-synthetic-pin"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">CPR_data</span> <span class="op">&lt;-</span> <span class="va">syntpop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    birth_year<span class="op">=</span><span class="fu">year</span><span class="op">(</span><span class="va">dob</span><span class="op">)</span>,</span>
<span>    birth_date<span class="op">=</span><span class="va">dob</span>,</span>
<span>    sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">gender</span><span class="op">==</span><span class="st">"M"</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    PIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">generateCPR</span>, <span class="va">birth_date</span>, sequence<span class="op">=</span><span class="va">lbnr</span>, <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">PIN</span>,<span class="va">place_of_birth</span>,<span class="va">residence_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">PIN</span>,<span class="va">place_of_birth</span>,<span class="va">residence_type</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CPR_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">sample_n</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">statgl_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In this deliberately small sample, the information is a snapshot, at
a specific point in time - the reference date. Included here is the PIN
and compressed basic details for clarity about birthplace and address.
In practice, the CPR system delivers extensive data, including detailed
address information, event dates, event types, and much more.</p>
<p>When received, the raw data is checked for errors. All variable
codes, should be known, the PIN shall be valid, values shall be within
acceptance bounds, etc.</p>
<p>Deviated variables, like age and gender, are calculated, using the
cran package cprr. Contents of the 2 variables ‘place of birth’ and
‘residence type’ are matched against code/text formats, making sure, all
are known values. If missing, the data needs attention.</p>
<p>Reference_date is a sepecial variable and is stored typically
formatted to year in annual statistics. Time is crucial to understand
the dataset.</p>
<p>Finally microdata are stored as a parquet file on disk, ready for
dissemination.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fmt_pob</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">place_of_birth</span>,<span class="op">~</span><span class="va">place_of_birth_txt</span>,</span>
<span>                  <span class="st">"N"</span>,<span class="st">"Born in Greenland"</span>,</span>
<span>                  <span class="st">"S"</span>,<span class="st">"Born outside Greenland"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fmt_res</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">residence_type</span>,<span class="op">~</span><span class="va">residence_type_txt</span>,</span>
<span>                  <span class="st">"A"</span>,<span class="st">"Capital city"</span>,</span>
<span>                  <span class="st">"B"</span>,<span class="st">"Main settlements"</span>,</span>
<span>                  <span class="st">"C"</span>,<span class="st">"Larger settlements"</span>,</span>
<span>                  <span class="st">"D"</span>,<span class="st">"Settlements"</span>,</span>
<span>                  <span class="st">"E"</span>,<span class="st">"Smaller settlements"</span>,</span>
<span>                  <span class="st">"F"</span>,<span class="st">"Smallest settlements"</span>,</span>
<span>                  <span class="st">"G"</span>,<span class="st">"Other localities"</span>,<span class="op">)</span></span>
<span></span>
<span><span class="va">df_raw</span> <span class="op">&lt;-</span> <span class="va">CPR_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>time<span class="op">=</span><span class="fu">year</span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span>,</span>
<span>         dob<span class="op">=</span><span class="fu">dob</span><span class="op">(</span><span class="va">PIN</span><span class="op">)</span>,</span>
<span>         age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu">age</span><span class="op">(</span><span class="va">PIN</span>,<span class="va">reference_date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         gender<span class="op">=</span><span class="fu">gender</span><span class="op">(</span><span class="va">PIN</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_check_me</span> <span class="op">&lt;-</span> <span class="va">df_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">fmt_pob</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">place_of_birth</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">fmt_res</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">residence_type</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">place_of_birth_txt</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">residence_type</span><span class="op">)</span><span class="op">)</span></span>
<span>         </span>
<span><span class="co"># Check if the data frame is empty</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_check_me</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_check_me</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"good to continue"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">write_parquet</span><span class="op">(</span><span class="va">df_raw</span>,<span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pgmPath</span>,<span class="st">"data"</span>,<span class="st">"df_raw.parquet"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">sample_n</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">statgl_table</span><span class="op">(</span>year_col<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="presenting-metadata-for-researchers-in-statbank-greenland">Presenting metadata for Researchers <br>in StatBank Greenland<a class="anchor" aria-label="anchor" href="#presenting-metadata-for-researchers-in-statbank-greenland"></a>
</h2>
<p>The purpose is to let researchers access metadata on datasets
gathered and stored in Statistics Greenland.</p>
<p>Statistics Greenland expects that anyone with professional needs for
knowledge on our society begin their learning path online in Statbank
Greenland. Next level, is to to learn about our datasources and to
understand the scope and limitation of each variable. Without needs to
learn an additional user interface.</p>
<p>Each register consists of a number of variables and for each variable
the Statbank system presents a table with a frequency count for each
time period. This does not reveal any confidential personal information,
as information cannot be combined, without access to more than one
variable.</p>
<p>To get access to research data, a formal contract has to be
negotiated, and access to micro data is only granted on a dedicated
research server.</p>
<p>The variables in a dataset comes in many classes:</p>
<p>ID - PIN, reference PIN (to mother, to father, to ..)</p>
<p>Date - date at event (birth~, death~, moving~, change~)</p>
<p>Classifications - birthplace, citizenship, gender, locality</p>
<p>Numeric - age, income, weight</p>
<p>Reference_date - time for compilation</p>
<div class="section level3">
<h3 id="preparing">Preparing<a class="anchor" aria-label="anchor" href="#preparing"></a>
</h3>
<p>With this in mind the variables in a dataset are prepared before
px-files are created. For example:</p>
<p><strong>PIN/ID</strong>, as there is no need to present individual
values for PINs, all are mutated to “count”.</p>
<p><strong>Date</strong>, is also too detailed to get a quick overview.
The researcher will learn, that the variable holds ‘dates’ and are
presented grouped by month.</p>
<p><strong>Classification</strong> will have a defined codelist with
code/text</p>
<p><strong>Numeric</strong> variables can be shown at detailed level
like 1-year age groups, income<sub>,weight</sub> intervals. It can be
relevant to prevent revealing personal information. Typically lower and
upper bounds are open classes, hiding data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df_ready</span> <span class="op">&lt;-</span> <span class="fu">read_parquet</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pgmPath</span>,<span class="st">"data"</span>,<span class="st">"df_raw.parquet"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>,<span class="va">PIN</span>,<span class="va">place_of_birth</span>,<span class="va">residence_type</span>,<span class="va">dob</span>,<span class="va">age</span>,<span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PIN<span class="op">=</span><span class="st">"count"</span>,</span>
<span>         dob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu">as_date</span><span class="op">(</span><span class="va">dob</span><span class="op">)</span>, <span class="st">"%m"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="convert-to-a-multi-lingual-px-object">Convert to a multi-lingual px-object<a class="anchor" aria-label="anchor" href="#convert-to-a-multi-lingual-px-object"></a>
</h3>
<p>Converting from a dataframe to a px-object is simple, the function
pxmake::px(), does the trick, and after creation, desired languague(s)
needs to be declared.</p>
<p>px_micro is designed to have the time variable in heading and the
focus variable as stub. So when px_heading is not empty, these variables
need to be moved from heading to stub using pxmake::px_stub(), before
executing pxmake::px_micro()</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># 1st conversion</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/px.html">px</a></span><span class="op">(</span><span class="va">df_ready</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_language.px.html">px_language</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                <span class="co"># English is set as mainlanguage</span></span>
<span>  <span class="fu"><a href="../reference/px_languages.px.html">px_languages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"en"</span>,<span class="st">"da"</span>,<span class="st">"kl"</span><span class="op">)</span><span class="op">)</span>      <span class="co"># and also Danish and Greenlandic shall </span></span>
<span></span>
<span><span class="co"># Check to see if numeric columns should be forced to sub</span></span>
<span><span class="fu"><a href="../reference/px_heading.px.html">px_heading</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#[1] "age"</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/px.html">px</a></span><span class="op">(</span><span class="va">df_ready</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_language.px.html">px_language</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                <span class="co"># English is set as mainlanguage</span></span>
<span>  <span class="fu"><a href="../reference/px_languages.px.html">px_languages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"en"</span>,<span class="st">"da"</span>,<span class="st">"kl"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># and also Danish and Greenlandic shall </span></span>
<span>  <span class="fu"><a href="../reference/px_timeval.px.html">px_timeval</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_stub.px.html">px_stub</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Second check</span></span>
<span><span class="fu"><a href="../reference/px_heading.px.html">px_heading</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#character(0)</span></span>
<span></span>
<span><span class="co"># ready for first px-file creation</span></span>
<span><span class="fu"><a href="../reference/px_micro.html">px_micro</a></span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pgmPath</span>,<span class="st">"px"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>pxmake::px_micro() creates a px-file for each variable in the
px-object</p>
<p><img src="px.png" fig-align="left" width="262"></p>
<p>At this point the px-files generated are still too sparse to open
with Pxwin, but Pxedit does. Pxedit also tells you, what mandatory
keywords are missing</p>
<p><img src="pxedit.png" fig-align="left" width="262"></p>
<p>So additional metadata must be added. For metadata general to all
files in the microdataset, adding information is straigth forward. Use
the relevant pxmake functions to bulk update all px-files in the
folder.</p>
<p>Statistics Greenland has chosen to present micro datasets in the same
topic structure as used for tables in Statbank Greenland for easier
navigation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">subject</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">language</span>, <span class="op">~</span><span class="va">value</span>,</span>
<span>          <span class="st">"en"</span>, <span class="st">"Population"</span>, </span>
<span>          <span class="st">"da"</span>, <span class="st">"Befolkning"</span>, </span>
<span>          <span class="st">"kl"</span>, <span class="st">"Innuttaasut"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">creation_date</span> <span class="op">&lt;-</span> <span class="st">"20240801 09:00"</span></span>
<span><span class="va">last_updated</span> <span class="op">&lt;-</span> <span class="st">"20240811 09:00"</span></span>
<span><span class="va">next_update</span>   <span class="op">&lt;-</span> <span class="st">"20250801 09:00"</span></span>
<span></span>
<span><span class="co"># 2nd conversion</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_ready</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">pxmake</span><span class="fu">::</span><span class="fu"><a href="../reference/px.html">px</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_codepage.px.html">px_codepage</a></span><span class="op">(</span><span class="st">"utf-8"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_language.px.html">px_language</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_languages.px.html">px_languages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"da"</span>, <span class="st">"kl"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_decimals.px.html">px_decimals</a></span><span class="op">(</span><span class="st">"0"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_showdecimals.px.html">px_showdecimals</a></span><span class="op">(</span><span class="st">"0"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_subject_code.px.html">px_subject_code</a></span><span class="op">(</span><span class="st">"BE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_subject_area.px.html">px_subject_area</a></span><span class="op">(</span><span class="va">subject</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_autopen.px.html">px_autopen</a></span><span class="op">(</span><span class="st">"YES"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>          <span class="co"># with only 2 variables, there is no need for selecting</span></span>
<span>  <span class="fu"><a href="../reference/px_stub.px.html">px_stub</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_timeval.px.html">px_timeval</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_units.px.html">px_units</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">language</span>, <span class="op">~</span><span class="va">value</span>,</span>
<span>                   <span class="st">"en"</span>, <span class="st">"Persons"</span>, </span>
<span>                   <span class="st">"da"</span>, <span class="st">"Personer"</span>, </span>
<span>                   <span class="st">"kl"</span>, <span class="st">"Inuit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_update_frequency.px.html">px_update_frequency</a></span><span class="op">(</span><span class="st">"Annually"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_creation_date.px.html">px_creation_date</a></span><span class="op">(</span><span class="va">creation_date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_last_updated.px.html">px_last_updated</a></span><span class="op">(</span><span class="va">last_updated</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_next_update.px.html">px_next_update</a></span><span class="op">(</span><span class="va">next_update</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_link.px.html">px_link</a></span><span class="op">(</span><span class="st">"www.stat.gl/bee202401/m1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_contact.px.html">px_contact</a></span><span class="op">(</span><span class="st">"Lars Pedersen, LARP at STAT.gl"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/px_source.px.html">px_source</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">language</span>, <span class="op">~</span><span class="va">value</span>,</span>
<span>            <span class="st">"en"</span>,  <span class="st">"Statistics Greenland"</span>,</span>
<span>            <span class="st">"da"</span>,  <span class="st">"Grønlands Statistik"</span>,</span>
<span>            <span class="st">"kl"</span>,  <span class="st">"Kalaallit Nunaanni Naatsorsueqqissaartarfik"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ready for 2nd px-file creation</span></span>
<span><span class="fu"><a href="../reference/px_micro.html">px_micro</a></span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pgmPath</span>,<span class="st">"px"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pxpob1.png" fig-align="left" width="362"></p>
<p>It gets a little more complicated with metadata, that are specific to
each of the px-files.</p>
<p>At table-level, description is shown in the menu, as variable
identifier. Contents hold the first leg of the title. Title consists of
contents and additional variable names (on microdata only time).
Valuenote(x) holds text information about each variable.</p>
<p>At variable-level codes needs to be defined with texts in all
languages.</p>
<p>To handle this, a dataframe with metadata, that will be added to each
file individually is created: here it is named metadoc</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">metadoc</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">variables2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span>variable<span class="op">=</span><span class="va">`variable-code`</span>, <span class="va">language</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>px_contents<span class="op">=</span><span class="va">variable</span>,</span>
<span>         px_title<span class="op">=</span><span class="va">variable</span>,</span>
<span>         px_matrix<span class="op">=</span><span class="va">variable</span>,</span>
<span>         px_description<span class="op">=</span><span class="va">variable</span>,</span>
<span>         px_matrix<span class="op">=</span><span class="va">variable</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ready for 4th px-file creation</span></span>
<span><span class="fu"><a href="../reference/px_micro.html">px_micro</a></span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pgmPath</span>,<span class="st">"px"</span><span class="op">)</span>, keyword_values <span class="op">=</span> <span class="va">metadoc</span><span class="op">)</span></span></code></pre></div>
<p>And when it comes to translating all codes to text in multple
languages, we can try to steal as much as possible from the Statbank.
Her the helper function ‘get_codelist’ comes in handy</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#hi &lt;- x$cells1</span></span>
<span></span>
<span><span class="va">codelist_age</span> <span class="op">&lt;-</span> <span class="fu">get_codelist</span><span class="op">(</span><span class="st">"BEXSTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"age"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="va">variable</span>,<span class="va">code</span>,<span class="va">language</span>,<span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codelist_age_order</span> <span class="op">&lt;-</span> <span class="fu">get_codelist</span><span class="op">(</span><span class="st">"BEXSTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"age"</span> <span class="op">&amp;</span> <span class="va">language</span><span class="op">==</span><span class="st">"en"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="va">variable</span>,<span class="va">code</span>,<span class="va">order</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codelist_pob</span> <span class="op">&lt;-</span> <span class="fu">get_codelist</span><span class="op">(</span><span class="st">"BEXSTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"place of birth"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span><span class="op">!=</span><span class="st">"T"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="va">variable</span>,<span class="va">code</span>,<span class="va">language</span>,<span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codelist_res</span> <span class="op">&lt;-</span> <span class="fu">get_codelist</span><span class="op">(</span><span class="st">"BEXSTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"residence type"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span><span class="op">!=</span><span class="st">"T"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="va">variable</span>,<span class="va">code</span>,<span class="va">language</span>,<span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codelist_gender</span> <span class="op">&lt;-</span> <span class="fu">get_codelist</span><span class="op">(</span><span class="st">"BEXSTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"gender"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="va">variable</span>,<span class="va">code</span>,<span class="va">language</span>,<span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codelist_dob</span> <span class="op">&lt;-</span> <span class="fu">get_codelist</span><span class="op">(</span><span class="st">"BEXBBDMD1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"month"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>code<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="va">variable</span>,<span class="va">code</span>,<span class="va">language</span>,<span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">variable_values</span> <span class="op">&lt;-</span> <span class="va">codelist_age</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">codelist_pob</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">codelist_res</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">codelist_gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">codelist_dob</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`variable-code`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">`variable-code`</span><span class="op">==</span><span class="st">"place of birth"</span>,<span class="st">"place_of_birth"</span>,<span class="va">`variable-code`</span><span class="op">)</span>,</span>
<span>         `variable-code`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">`variable-code`</span><span class="op">==</span><span class="st">"residence type"</span>,<span class="st">"residence_type"</span>,<span class="va">`variable-code`</span><span class="op">)</span>,</span>
<span>         `variable-code`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">`variable-code`</span><span class="op">==</span><span class="st">"month"</span>,<span class="st">"dob"</span>,<span class="va">`variable-code`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_values.px.html">px_values</a></span><span class="op">(</span><span class="va">variable_values</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/px_order.px.html">px_order</a></span><span class="op">(</span><span class="va">codelist_age_order</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ready for 4th px-file creation</span></span>
<span><span class="fu"><a href="../reference/px_micro.html">px_micro</a></span><span class="op">(</span><span class="va">x1</span>,<span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pgmPath</span>,<span class="st">"px"</span><span class="op">)</span>, keyword_values <span class="op">=</span> <span class="va">metadoc</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johan Ejstrud, Lars Pedersen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
